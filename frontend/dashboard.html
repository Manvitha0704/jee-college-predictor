<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JEE College Predictor Dashboard</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- FontAwesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
  <!-- Custom CSS -->
  <link rel="stylesheet" href="dashboard.css" />
</head>
<body>

<div class="container-fluid">
  <div class="row main-content">
    <!-- Left Section -->
    <div class="col-md-8 text-center animate__animated animate__fadeInLeft">
      <h2 class="mb-4">Welcome to the JEE College Predictor</h2>
      <p class="description">
        Our website intelligently predicts your most suitable colleges based on your JEE rank.
        Get access to live counseling updates, explore seat matrices filtered by your category,
        and read verified college reviews to make smarter decisions for your future.
      </p>
    </div>

    <!-- Right Section -->
    <div class="col-md-4 d-flex justify-content-center align-items-center animate__animated animate__fadeInRight">
      <div class="card login-card p-4 w-100" id="authCard">
        
        <!-- Login Form -->
        <div id="loginFormContainer">
          <h4 class="mb-4 text-center">Login to Your Account</h4>
          <form id="loginForm">
            <div class="mb-3">
              <input type="text" class="form-control" id="loginUsername" placeholder="Username" required />
            </div>
            <div class="mb-3">
              <input type="password" class="form-control" id="loginPassword" placeholder="Password" required />
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
          </form>
          <p class="mt-3 text-center">Don't have an account? <a href="#" id="showRegister" class="text-danger">Register here</a></p>
          <p class="mt-2 text-center"><a href="#" id="showForgot" class="text-warning">Forgot password?</a></p>
        </div>

        <!-- Register Form -->
        <div id="registerFormContainer" style="display: none;">
          <h4 class="mb-4 text-center">Create a New Account</h4>
          <form id="registerForm">
            <div class="mb-3">
              <input type="text" class="form-control" id="registerUsername" placeholder="Username" required />
            </div>
            <div class="mb-3">
              <input type="email" class="form-control" id="registerEmail" placeholder="Email" required />
            </div>
            <div class="mb-3">
              <input type="password" class="form-control" id="registerPassword" placeholder="Password" required />
            </div>
            <button type="submit" class="btn btn-success w-100">Register</button>
          </form>
          <p class="mt-3 text-center">Already have an account? <a href="#" id="showLogin" class="text-primary">Login here</a></p>
        </div>

        <!-- Forgot Password Form -->
        <div id="forgotFormContainer" style="display: none;">
          <h4 class="mb-4 text-center">Reset Your Password</h4>
          <form id="forgotForm">
            <div class="mb-3">
              <input type="email" class="form-control" id="forgotEmail" placeholder="Enter your registered email" required />
            </div>
            <button type="submit" class="btn btn-warning w-100">Send Reset Link</button>
          </form>
          <p class="mt-3 text-center"><a href="#" id="backToLoginFromForgot" class="text-primary">Back to Login</a></p>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Animate.css -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.js"></script>

<!-- Custom Script -->
<script>
  // Redirect if already logged in (session-based)
  if (sessionStorage.getItem('loggedInUser')) {
    window.location.href = 'home.html';
  }

  // Toggle forms
  document.getElementById('showRegister').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('loginFormContainer').style.display = 'none';
    document.getElementById('registerFormContainer').style.display = 'block';
    document.getElementById('forgotFormContainer').style.display = 'none';
  });

  document.getElementById('showLogin').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('registerFormContainer').style.display = 'none';
    document.getElementById('forgotFormContainer').style.display = 'none';
    document.getElementById('loginFormContainer').style.display = 'block';
  });

  document.getElementById('showForgot').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('loginFormContainer').style.display = 'none';
    document.getElementById('registerFormContainer').style.display = 'none';
    document.getElementById('forgotFormContainer').style.display = 'block';
  });

  document.getElementById('backToLoginFromForgot').addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('forgotFormContainer').style.display = 'none';
    document.getElementById('loginFormContainer').style.display = 'block';
  });

  // Login
  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;

    fetch('http://localhost:3000/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password })
    })
    .then(response => {
      if (!response.ok) throw new Error('Login failed. Please check your credentials.');
      return response.json();
    })
    .then(data => {
      sessionStorage.setItem('loggedInUser', JSON.stringify({ username }));
      window.location.href = 'home.html';
    })
    .catch(error => alert(error.message));
  });

  // Register
  document.getElementById('registerForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const username = document.getElementById('registerUsername').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;

    fetch('http://localhost:3000/register', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, email, password })
    })
    .then(response => {
      if (!response.ok) throw new Error('Registration failed. Username may already exist.');
      return response.json();
    })
    .then(data => {
      alert(data.message);
      document.getElementById('registerFormContainer').style.display = 'none';
      document.getElementById('loginFormContainer').style.display = 'block';
      document.getElementById('registerForm').reset();
    })
    .catch(error => alert(error.message));
  });

  // Forgot Password Submit
  document.getElementById('forgotForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const email = document.getElementById('forgotEmail').value;

    fetch('http://localhost:3000/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    })
    .then(response => {
      if (!response.ok) throw new Error('Failed to send reset link. Email may not exist.');
      return response.json();
    })
    .then(data => {
      alert(data.message);
      document.getElementById('forgotForm').reset();
      document.getElementById('forgotFormContainer').style.display = 'none';
      document.getElementById('loginFormContainer').style.display = 'block';
    })
    .catch(error => alert(error.message));
  });
</script>

</body>
</html>
