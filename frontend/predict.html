<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Predict Colleges - JEE College Predictor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="predict.css" />
</head>

<body>
  <div class="container mt-5">
    <h2 class="text-center mb-4">Predict Your College</h2>

    <form id="predictForm" class="card p-4 shadow-sm">
      <div class="mb-3">
        <label for="rank" class="form-label">JEE Rank</label>
        <input type="number" class="form-control" id="rank" name="rank" required />
      </div>

      <div class="mb-3">
        <label for="category" class="form-label">Category</label>
        <select class="form-select" id="category" name="category" required>
          <option value="">Select Category</option>
          <option value="OPEN">OPEN</option>
          <option value="EWS">EWS</option>
          <option value="OBC-NCL">OBC-NCL</option>
          <option value="SC">SC</option>
          <option value="ST">ST</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="gender" class="form-label">Gender</label>
        <select class="form-select" id="gender" name="gender" required>
          <option value="">Select Gender</option>

          <option value="Female">Female</option>
          <option value="Gender-Neutral">Gender-Neutral</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="round" class="form-label">Round</label>
        <select class="form-select" id="round" name="round" required>
          <option value="">Select Round</option>
          <option value="1">Round 1</option>
          <option value="2">Round 2</option>
          <option value="3">Round 3</option>
          <option value="4">Round 4</option>
          <option value="5">Round 5</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary w-100">Predict Colleges</button>
    </form>

    <div id="loader" class="text-center mt-4" style="display:none;">
      <div class="spinner-border text-primary" role="status"></div>
      <p>Loading predictions...</p>
    </div>

    <div id="results" class="mt-5"></div>
  </div>
  <script>
    document.getElementById('predictForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const rank = document.getElementById('rank').value;
      const category = document.getElementById('category').value;
      const round = document.getElementById('round').value;
      const gender = document.getElementById('gender').value;

      const resultsDiv = document.getElementById('results');
      const loader = document.getElementById('loader');

      resultsDiv.innerHTML = '';
      loader.style.display = 'block'; // show loading spinner

      try {
        const response = await fetch('http://localhost:3000/predict', {

          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ rank, category, round, gender })
        });

        const data = await response.json();
        loader.style.display = 'none'; // hide loading spinner

        if (data.message) {
          resultsDiv.innerHTML = `<p class="text-danger">${data.message}</p>`;
          return;
        }

        displayResults(data);
      } catch (error) {
        console.error('Fetch error:', error);
        loader.style.display = 'none';
        resultsDiv.innerHTML = '<p class="text-danger">Error fetching data. Please try again later.</p>';
      }
    });

    function displayResults(data) {
      const resultsDiv = document.getElementById('results');

      if (!data.colleges || data.colleges.length === 0) {
        resultsDiv.innerHTML = `
      <div class="card text-center p-4 shadow-sm" style="background: #f8d7da; border-left: 5px solid #972222; border-radius: 8px;">
        <h4 style="color: #972222;">Oops!</h4>
        <p style="color: #555;">We couldn't find any college matching your rank and category. Please try adjusting your inputs!</p>
      </div>
    `;
        return;
      }
      let html = '<div class="row">';
      data.colleges.forEach(college => {
        html += `
      <div class="col-md-6">
        <div class="card mb-3 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">${college.institute}</h5>
            <p class="card-text"><strong>Branch:</strong> ${college.branch}</p>
            <p class="card-text"><strong>Category:</strong> ${college.category}</p>
            <p class="card-text"><strong>Gender:</strong> ${college.gender}</p>
            <p class="card-text"><strong>Closing Rank:</strong> ${college.closing_rank}</p>
          </div>
        </div>
      </div>
    `;
      });
      html += '</div>';

      resultsDiv.innerHTML = html;
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>